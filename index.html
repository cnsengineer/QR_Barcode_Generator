<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CNS : Generator Tools 2026 (Final Masterpiece)</title>
    
    <meta name="theme-color" content="#0046be">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="icon" type="image/png" href="Logo.png">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script> window.DOMQRCode = window.QRCode; </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.1/qrcode.min.js"></script>
    <script> window.HeadlessQRCode = window.QRCode; window.QRCode = window.DOMQRCode; </script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        /* --- CSS Design System --- */
        :root {
            --primary: #0f172a; --accent: #0046be; --accent-hover: #003399;
            --bg: #f3f6fc; --sidebar-bg: #ffffff; --text-main: #1e293b; --text-sec: #64748b;
            --border: #e2e8f0; --card-bg: #ffffff; --input-bg: #ffffff;
            --drop-bg: #f8fafc; --drop-border: #cbd5e1;
            --success: #10b981; --danger: #ef4444; --warning: #f59e0b; 
            --sidebar-width: 280px;
        }
        [data-theme="dark"] {
            --primary: #f8fafc; --accent: #3b82f6; --accent-hover: #60a5fa;
            --bg: #0f172a; --sidebar-bg: #1e293b; --text-main: #f1f5f9; --text-sec: #94a3b8;
            --border: #334155; --card-bg: #1e293b; --input-bg: #334155;
            --drop-bg: #0f172a; --drop-border: #475569;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Sarabun', sans-serif; background: var(--bg); color: var(--text-main); margin: 0; display: flex; height: 100vh; overflow: hidden; transition: background 0.3s, color 0.3s; }
        
        /* Top Controls */
        .top-controls { position: fixed; top: 20px; right: 20px; z-index: 1100; display: flex; gap: 10px; }
        .control-btn { background: var(--card-bg); border: 2px solid var(--border); padding: 8px 16px; border-radius: 30px; font-size: 0.9rem; font-weight: 700; color: var(--text-main); cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .control-btn:hover { border-color: var(--accent); color: var(--accent); transform: translateY(-2px); }

        /* Sidebar */
        aside { 
            width: var(--sidebar-width); background: var(--sidebar-bg); border-right: 1px solid var(--border); 
            display: flex; flex-direction: column; padding: 1.5rem 1rem; 
            box-shadow: 2px 0 15px rgba(0,0,0,0.03); z-index: 900; transition: transform 0.3s ease; 
            height: 100vh;
        }
        .brand { display: flex; flex-direction: column; align-items: center; text-align: center; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border); flex-shrink: 0; }
        .brand-logo { max-width: 160px; height: auto; margin-bottom: 15px; display: block; object-fit: contain; transition: transform 0.3s; }
        .brand-logo:hover { transform: scale(1.05); }
        .program-name { font-size: 1.2rem; font-weight: 800; color: var(--accent); margin: 0; }
        .company-name { font-size: 0.75rem; color: var(--text-sec); margin-top: 5px; font-weight: 500; }

        nav { flex: 1; overflow-y: auto; margin-top: 10px; padding-right: 5px; padding-bottom: 40px; }
        nav::-webkit-scrollbar { width: 4px; }
        nav::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
        .nav-group-title { font-size: 0.75rem; color: var(--text-sec); font-weight: 700; margin: 15px 0 5px 10px; text-transform: uppercase; letter-spacing: 0.5px; }
        nav button { width: 100%; text-align: left; padding: 12px 15px; margin-bottom: 4px; border: none; background: none; border-radius: 8px; color: var(--text-sec); cursor: pointer; font-family: 'Sarabun', sans-serif; font-size: 0.9rem; font-weight: 500; display: flex; align-items: center; gap: 12px; transition: background-color 0.2s, color 0.2s; }
        nav button:hover { background: var(--bg); color: var(--accent); }
        nav button.active { background: rgba(0, 70, 190, 0.08); color: var(--accent); font-weight: 700; border-left: 4px solid var(--accent); }
        [data-theme="dark"] nav button.active { background: rgba(59, 130, 246, 0.15); }
        nav button i { width: 24px; text-align: center; font-size: 1.1rem; }
        
        .dev-info { margin-top: auto; font-size: 0.7rem; color: var(--text-sec); text-align: center; border-top: 1px solid var(--border); padding-top: 1rem; line-height: 1.6; flex-shrink: 0; }

        /* Main Content */
        main { flex: 1; padding: 2rem; overflow-y: auto; position: relative; }
        .tool-panel { display: none; max-width: 900px; margin: 0 auto; animation: fadeIn 0.4s ease; padding-bottom: 60px; }
        .tool-panel.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        .panel-header { display: flex; justify-content: space-between; align-items: flex-start; border-bottom: 2px solid var(--border); padding-bottom: 15px; margin-bottom: 1.5rem; }
        .panel-header h2 { color: var(--accent); margin: 0; display: flex; align-items: center; gap: 12px; font-size: 1.5rem; }
        .tool-desc { color: var(--text-sec); margin: 5px 0 0 0; font-size: 0.95rem; }

        .btn-reset { background: transparent; color: var(--text-sec); border: 1px solid var(--border); padding: 6px 12px; border-radius: 6px; font-size: 0.85rem; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 5px; }
        .btn-reset:hover { border-color: var(--danger); color: var(--danger); background: rgba(239, 68, 68, 0.1); }

        /* --- CARD & PREVIEW --- */
        .card { 
            background: var(--card-bg); border-radius: 12px; padding: 2rem; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.05); border: 1px solid var(--border); 
            transition: background 0.3s;
            display: flex; flex-direction: column;
            min-height: 720px;
        }
        .preview-zone { 
            border: 2px dashed var(--drop-border); border-radius: 10px; padding: 2rem; 
            text-align: center; background-color: var(--drop-bg); margin-bottom: 1.5rem;
            min-height: 280px; display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .preview-zone img, .preview-zone canvas { 
            max-width: 100%; height: auto; padding: 10px; background: white; 
            border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
        }

        /* --- LOGO UPLOADER --- */
        .logo-uploader { text-align: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border); }
        .logo-label { cursor: pointer; color: var(--accent); display: inline-flex; align-items: center; gap: 8px; font-weight: 600; font-size: 0.95rem; padding: 8px 16px; border-radius: 20px; background: rgba(0, 70, 190, 0.05); transition: all 0.2s; }
        .logo-label:hover { background: rgba(0, 70, 190, 0.1); transform: translateY(-1px); }
        .logo-name { font-size: 0.85rem; color: var(--text-sec); display: block; margin-top: 5px; }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 1rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-main); font-size: 0.9rem; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-family: 'Sarabun', sans-serif; outline: none; transition: border 0.2s; font-size: 0.95rem; background: var(--input-bg); color: var(--text-main); }
        .form-group textarea { resize: vertical; min-height: 80px; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(0, 70, 190, 0.1); }
        .form-group input:disabled { background-color: var(--drop-bg); color: var(--text-sec); cursor: not-allowed; }

        .checkbox-wrapper { display: flex; align-items: center; gap: 10px; cursor: pointer; color: var(--text-main); font-size: 0.95rem; margin-top: 5px; user-select: none; }
        .checkbox-wrapper input { width: 18px; height: 18px; margin: 0; cursor: pointer; }

        .pass-display { font-family: monospace; font-size: 1.5rem; font-weight: 700; color: var(--accent); background: var(--drop-bg); padding: 15px; border-radius: 8px; border: 1px solid var(--border); text-align: center; letter-spacing: 2px; margin-bottom: 20px; word-break: break-all; }

        /* --- BULK TOOL CSS --- */
        .instruction-box { background: rgba(0, 70, 190, 0.05); border-radius: 10px; padding: 1rem 1.5rem; margin-bottom: 1.5rem; border: 1px solid rgba(0, 70, 190, 0.1); }
        .instruction-title { font-weight: 700; color: var(--accent); margin-bottom: 10px; display: flex; align-items: center; gap: 8px; font-size: 1rem; }
        .step-list { margin: 0; padding-left: 20px; color: var(--text-sec); font-size: 0.95rem; line-height: 1.6; }
        .step-list li { margin-bottom: 5px; }

        .upload-zone { border: 2px dashed var(--accent); border-radius: 10px; padding: 3rem 2rem; text-align: center; background-color: var(--drop-bg); cursor: pointer; transition: all 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 15px; margin-bottom: 1rem; }
        .upload-zone:hover, .upload-zone.dragover { background-color: rgba(0, 70, 190, 0.08); transform: scale(1.01); }
        .upload-icon { font-size: 3rem; color: var(--accent); }
        .upload-text { font-size: 1.1rem; font-weight: 600; color: var(--text-main); }
        .upload-sub { font-size: 0.9rem; color: var(--text-sec); }
        .preview-container { margin-top: 20px; overflow-x: auto; border: 1px solid var(--border); border-radius: 8px; display: none; }
        .bulk-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        .bulk-table th { background: var(--drop-bg); color: var(--text-main); font-weight: 700; text-align: left; padding: 12px; border-bottom: 2px solid var(--border); white-space: nowrap; }
        .bulk-table td { padding: 10px 12px; border-bottom: 1px solid var(--border); color: var(--text-sec); vertical-align: middle; }
        .progress-container { margin-top: 20px; display: none; }
        .progress-bar-bg { width: 100%; height: 10px; background: var(--border); border-radius: 5px; overflow: hidden; }
        .progress-bar-fill { height: 100%; background: var(--success); width: 0%; transition: width 0.2s; }
        .progress-text { text-align: center; font-size: 0.9rem; margin-top: 5px; color: var(--text-main); }

        /* --- ACTION FOOTER --- */
        .action-footer { margin-top: auto; padding-top: 20px; border-top: 1px solid var(--border); }
        .btn-action { width: 100%; background: linear-gradient(135deg, var(--accent) 0%, var(--accent-hover) 100%); color: #fff; padding: 15px; border: none; border-radius: 10px; font-size: 1.05rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; transition: all 0.2s; font-family: 'Sarabun', sans-serif; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn-action:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0, 70, 190, 0.3); }
        .btn-action:disabled { background: var(--text-sec); cursor: not-allowed; transform: none; box-shadow: none; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text-main); font-weight: 600; padding: 10px; }
        .btn-outline:hover { background: var(--drop-bg); border-color: var(--accent); color: var(--accent); box-shadow: none; }

        .privacy-badge { display: inline-flex; align-items: center; gap: 8px; background: rgba(16, 185, 129, 0.1); color: var(--success); padding: 8px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; margin-top: 1rem; width: fit-content; border: 1px solid rgba(16, 185, 129, 0.2); }
        
        #toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .toast { pointer-events: auto; background: var(--card-bg); color: var(--text-main); padding: 14px 20px; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.25); display: flex; align-items: center; gap: 12px; animation: slideUp 0.3s; border-left: 5px solid var(--accent); min-width: 280px; font-weight: 600; font-size: 0.95rem; }
        .toast.success { border-left-color: var(--success); }
        .toast.error { border-left-color: var(--danger); }
        
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* Responsive */
        @media (max-width: 768px) { 
            .menu-toggle { display: block; } 
            aside { position: fixed; top: 0; left: 0; height: 100%; transform: translateX(-100%); box-shadow: 10px 0 20px rgba(0,0,0,0.1); } 
            aside.open { transform: translateX(0); } 
            main { padding: 5rem 1rem 2rem 1rem; } 
            .card { min-height: auto; padding: 1.5rem; } 
            .grid-2 { grid-template-columns: 1fr; gap: 1rem; } 
            .top-controls { top: 15px; right: 15px; } 
            .control-btn { padding: 6px 12px; } 
            .menu-overlay.active { display: block; } 
        }
        
        .menu-toggle { display: none; position: fixed; top: 20px; left: 20px; z-index: 1001; background: var(--accent); color: #fff; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .menu-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 800; backdrop-filter: blur(2px); }
        ::-webkit-scrollbar { width: 8px; height: 8px; } ::-webkit-scrollbar-track { background: transparent; } ::-webkit-scrollbar-thumb { background: var(--drop-border); border-radius: 4px; } ::-webkit-scrollbar-thumb:hover { background: var(--text-sec); }

        /* --- PRINT MODE --- */
        @media print {
            aside, .top-controls, .panel-header button, .btn-action, .btn-outline, 
            .form-group, .privacy-badge, .menu-toggle, #toast-container, .tool-desc, .nav-group-title, .action-footer, .logo-uploader { display: none !important; }
            body, main { background: white; color: black; padding: 0; margin: 0; height: auto; overflow: visible; }
            .card { box-shadow: none; border: none; padding: 0; margin: 0; min-height: auto; }
            .preview-zone { border: none; background: transparent; padding: 0; min-height: auto; margin: 0 auto; }
            .tool-panel { display: none; }
            .tool-panel.active { display: block; text-align: center; }
            .panel-header { border: none; justify-content: center; margin-bottom: 20px; }
            .panel-header h2 { font-size: 2rem; color: black; }
            .preview-zone img, .preview-zone canvas { max-width: 100%; width: 350px !important; height: auto !important; box-shadow: none; border: 1px solid #ddd; }
            .pass-display { border: 2px solid black; color: black; background: white; }
        }
    </style>
</head>
<body>

    <button class="menu-toggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
    <div class="menu-overlay" onclick="toggleSidebar()"></div>
    
    <div class="top-controls">
        <button class="control-btn" onclick="toggleTheme()" title="Toggle Dark Mode"><i class="fas fa-moon" id="theme-icon"></i></button>
        <button class="control-btn" onclick="toggleLanguage()"><i class="fas fa-globe"></i> <span id="lang-label">TH</span></button>
    </div>

    <aside id="sidebar">
        <div class="brand">
            <img src="Logo.png" alt="Logo" class="brand-logo" onerror="this.style.display='none';">
            <h1 class="program-name">CNS : Generator Tools</h1>
            <p class="company-name">CNS Computer Co., Ltd.</p>
        </div>
        <nav>
            <div class="nav-group-title" data-i18n="grp_gen">Generators</div>
            <button class="active" onclick="switchTab('promptpay', this)"><i class="fas fa-hand-holding-dollar"></i> <span data-i18n="menu_pp">Thai PromptPay</span></button>
            <button onclick="switchTab('qr', this)"><i class="fas fa-qrcode"></i> <span data-i18n="menu_qr">QR Code</span></button>
            <button onclick="switchTab('vcard', this)"><i class="fas fa-address-card"></i> <span data-i18n="menu_vcard">VCard</span></button>
            <button onclick="switchTab('location', this)"><i class="fas fa-map-marked-alt"></i> <span data-i18n="menu_loc">Location (Map)</span></button>
            <button onclick="switchTab('event', this)"><i class="fas fa-calendar-check"></i> <span data-i18n="menu_event">Event (Calendar)</span></button>
            <button onclick="switchTab('password', this)"><i class="fas fa-key"></i> <span data-i18n="menu_pass">Password Gen</span></button>
            <button onclick="switchTab('barcode', this)"><i class="fas fa-barcode"></i> <span data-i18n="menu_barcode">Barcode Maker</span></button>
            <button onclick="switchTab('wifi', this)"><i class="fas fa-wifi"></i> <span data-i18n="menu_wifi">WiFi QR</span></button>
            
            <div class="nav-group-title" data-i18n="grp_bulk">Batch Processing</div>
            <button onclick="switchTab('bulk', this)"><i class="fas fa-file-excel"></i> <span data-i18n="menu_bulk">Bulk QR Excel</span></button>
        </nav>
        <div class="dev-info">¬© 2026 CNS Computer Co., Ltd.<br><span style="color: var(--accent); font-weight: 600;">Developed by MaRcH WoRaWiT</span></div>
    </aside>

    <main>
        <div id="promptpay" class="tool-panel active">
            <div class="panel-header"><div><h2><i class="fas fa-hand-holding-dollar"></i> <span data-i18n="title_pp">Thai PromptPay</span></h2><p class="tool-desc" data-i18n="desc_pp">‡∏™‡∏£‡πâ‡∏≤‡∏á QR ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡πÑ‡∏ó‡∏¢ (‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå)</p></div></div>
            <div class="card">
                <div class="preview-zone" id="dz-promptpay"><div id="pp-qrcode"></div><span style="margin-top:10px; font-size:0.9rem; color:var(--text-sec);" data-i18n="hint_preview">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á QR Code ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</span></div>
                <div class="logo-uploader"><label class="logo-label" onclick="document.getElementById('pp-logo').click()"><i class="fas fa-image"></i> <span data-i18n="lbl_logo_add">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏™‡πà‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á</span></label><input type="file" id="pp-logo" accept="image/*" onchange="debouncedPP()" style="display:none;"><span id="pp-logo-name" class="logo-name"></span></div>
                
                <div class="form-group">
                    <label data-i18n="lbl_acc_type">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏±‡∏ç‡∏ä‡∏µ (Account Type)</label>
                    <select id="pp-type" onchange="updatePPPlaceholder(); debouncedPP();">
                        <option value="mobile">üì± ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ (Mobile 0xx...)</option>
                        <option value="id">üÜî ‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô (National ID 13 digits)</option>
                        <option value="wallet">üí∞ E-Wallet (15 digits)</option>
                    </select>
                </div>

                <div class="grid-2">
                    <div class="form-group"><label data-i18n="lbl_pp_id">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ / ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label><input type="tel" id="pp-id" oninput="debouncedPP()" placeholder="08x-xxx-xxxx"></div>
                    <div class="form-group"><label data-i18n="lbl_pp_amount">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label><input type="number" id="pp-amount" oninput="debouncedPP()" step="0.01" placeholder="0.00"></div>
                </div>
                <div class="action-footer"><div class="grid-2" style="margin-top: 0;"><button class="btn-action btn-outline" onclick="attemptCopy('pp-qrcode')"><i class="fas fa-copy"></i> <span data-i18n="btn_copy">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏π‡∏õ</span></button><button class="btn-action" onclick="downloadImage('pp-qrcode', 'PromptPay')"><i class="fas fa-download"></i> <span data-i18n="btn_download">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</span></button></div></div>
            </div>
        </div>

        <div id="qr" class="tool-panel">
            <div class="panel-header"><div><h2><i class="fas fa-qrcode"></i> <span data-i18n="title_qr">QR Code</span></h2><p class="tool-desc" data-i18n="desc_qr">‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏¥‡πâ‡∏á‡∏Å‡πå</p></div></div>
            <div class="card">
                <div class="preview-zone" id="dz-qr"><div id="qrcode"></div></div>
                <div class="logo-uploader"><label class="logo-label" onclick="document.getElementById('qr-logo').click()"><i class="fas fa-image"></i> <span data-i18n="lbl_logo_add">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏™‡πà‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á</span></label><input type="file" id="qr-logo" accept="image/*" onchange="debouncedQR()" style="display:none;"><span id="qr-logo-name" class="logo-name"></span></div>
                
                <div class="form-group">
                    <label data-i18n="lbl_data_type">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Data Type)</label>
                    <select id="qr-type" onchange="updateQRPlaceholder(); debouncedQR();">
                        <option value="text">üî§ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° / URL (Text)</option>
                        <option value="url">üåê ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå (Website URL)</option>
                        <option value="tel">üìû ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ (Tel/Call)</option>
                        <option value="sms">üí¨ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (SMS)</option>
                        <option value="email">üìß ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏• (Email)</option>
                    </select>
                </div>

                <div class="form-group"><label data-i18n="lbl_text">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° / ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label><input type="text" id="qr-text" oninput="debouncedQR()" placeholder="https://www.example.com"></div>
                <div class="grid-2">
                    <div class="form-group"><label data-i18n="lbl_size">‡∏Ç‡∏ô‡∏≤‡∏î (px)</label><input type="number" id="qr-size" value="250" oninput="debouncedQR()" step="10" min="50"></div>
                    <div class="form-group"><label data-i18n="lbl_color">‡∏™‡∏µ</label><input type="color" id="qr-color" value="#000000" style="height:48px; width:100%;" oninput="debouncedQR()"></div>
                </div>
                <div class="action-footer"><div class="grid-2" style="margin-top: 0;"><button class="btn-action btn-outline" onclick="attemptCopy('qrcode')"><i class="fas fa-copy"></i> <span data-i18n="btn_copy">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏π‡∏õ</span></button><button class="btn-action" onclick="downloadImage('qrcode', 'QR')"><i class="fas fa-download"></i> <span data-i18n="btn_download">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</span></button></div></div>
            </div>
        </div>

        <div id="vcard" class="tool-panel">
            <div class="panel-header"><div><h2><i class="fas fa-address-card"></i> <span data-i18n="title_vcard">VCard (Business Card)</span></h2><p class="tool-desc" data-i18n="desc_vcard">‡∏™‡∏£‡πâ‡∏≤‡∏á QR ‡∏ô‡∏≤‡∏°‡∏ö‡∏±‡∏ï‡∏£‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏• ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠</p></div></div>
            <div class="card">
                <div class="preview-zone" id="dz-vcard"><div id="vcard-qrcode"></div></div>
                <div class="logo-uploader"><label class="logo-label" onclick="document.getElementById('vcard-logo').click()"><i class="fas fa-image"></i> <span data-i18n="lbl_logo_add">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏™‡πà‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á</span></label><input type="file" id="vcard-logo" accept="image/*" onchange="debouncedVCard()" style="display:none;"><span id="vcard-logo-name" class="logo-name"></span></div>
                
                <div class="grid-2">
                    <div class="form-group"><label data-i18n="lbl_fname">‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á (First Name)</label><input type="text" id="vc-fname" oninput="debouncedVCard()" placeholder="Somchai"></div>
                    <div class="form-group"><label data-i18n="lbl_lname">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (Last Name)</label><input type="text" id="vc-lname" oninput="debouncedVCard()" placeholder="Jaidee"></div>
                </div>
                
                <div class="grid-2">
                    <div class="form-group"><label data-i18n="lbl_org">‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó (Company)</label><input type="text" id="vc-org" oninput="debouncedVCard()" placeholder="CNS Computer"></div>
                    <div class="form-group"><label data-i18n="lbl_title">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (Job Title)</label><input type="text" id="vc-title" oninput="debouncedVCard()" placeholder="Manager"></div>
                </div>

                <div class="grid-2">
                    <div class="form-group"><label data-i18n="lbl_tel">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ (Mobile)</label><input type="tel" id="vc-tel" oninput="debouncedVCard()" placeholder="081-234-5678"></div>
                    <div class="form-group"><label data-i18n="lbl_email">‡∏≠‡∏µ‡πÄ‡∏°‡∏• (Email)</label><input type="email" id="vc-email" oninput="debouncedVCard()" placeholder="email@example.com"></div>
                </div>
                
                <div class="form-group"><label data-i18n="lbl_website">‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå (Website)</label><input type="url" id="vc-url" oninput="debouncedVCard()" placeholder="www.example.com"></div>
                <div class="form-group"><label data-i18n="lbl_address">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà (Address)</label><textarea id="vc-adr" oninput="debouncedVCard()" placeholder="123 Sukhumvit Rd..."></textarea></div>
                <div class="form-group"><label data-i18n="lbl_note">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (Note)</label><textarea id="vc-note" oninput="debouncedVCard()" placeholder="Line ID: @cns, FB: CNS Page..."></textarea></div>
                
                <div class="action-footer"><div class="grid-2" style="margin-top: 0;"><button class="btn-action btn-outline" onclick="attemptCopy('vcard-qrcode')"><i class="fas fa-copy"></i> <span data-i18n="btn_copy">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏π‡∏õ</span></button><button class="btn-action" onclick="downloadImage('vcard-qrcode', 'VCard')"><i class="fas fa-download"></i> <span data-i18n="btn_download">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</span></button></div></div>
            </div>
        </div>

        <div id="location" class="tool-panel">
            <div class="panel-header"><div><h2><i class="fas fa-map-marked-alt"></i> <span data-i18n="title_loc">Location Map</span></h2><p class="tool-desc" data-i18n="desc_loc">‡∏™‡∏£‡πâ‡∏≤‡∏á QR ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà (Google Maps)</p></div></div>
            <div class="card">
                <div class="preview-zone" id="dz-loc"><div id="loc-qrcode"></div></div>
                <div class="logo-uploader"><label class="logo-label" onclick="document.getElementById('loc-logo').click()"><i class="fas fa-image"></i> <span data-i18n="lbl_logo_add">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏™‡πà‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á</span></label><input type="file" id="loc-logo" accept="image/*" onchange="generateLocation()" style="display:none;"><span id="loc-logo-name" class="logo-name"></span></div>
                <button class="btn-action btn-outline" onclick="getLocation()" style="margin-bottom:15px; margin-top:0;"><i class="fas fa-location-arrow"></i> <span data-i18n="btn_get_loc">‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (GPS)</span></button>
                <div class="grid-2">
                    <div class="form-group"><label>Latitude</label><input type="number" id="loc-lat" oninput="generateLocation()" placeholder="13.7563" step="any"></div>
                    <div class="form-group"><label>Longitude</label><input type="number" id="loc-long" oninput="generateLocation()" placeholder="100.5018" step="any"></div>
                </div>
                <p style="font-size:0.85rem; color:var(--text-sec); text-align:center;">* ‡∏™‡πÅ‡∏Å‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ Google Maps ‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
                <div class="action-footer"><div class="grid-2" style="margin-top: 0;"><button class="btn-action btn-outline" onclick="attemptCopy('loc-qrcode')"><i class="fas fa-copy"></i> <span data-i18n="btn_copy">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏π‡∏õ</span></button><button class="btn-action" onclick="downloadImage('loc-qrcode', 'Location')"><i class="fas fa-download"></i> <span data-i18n="btn_download">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</span></button></div></div>
            </div>
        </div>

        <div id="event" class="tool-panel">
            <div class="panel-header"><div><h2><i class="fas fa-calendar-check"></i> <span data-i18n="title_event">Event Calendar</span></h2><p class="tool-desc" data-i18n="desc_event">‡∏™‡∏£‡πâ‡∏≤‡∏á QR ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢ / ‡∏•‡∏á‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô (iCalendar)</p></div></div>
            <div class="card">
                <div class="preview-zone" id="dz-event"><div id="event-qrcode"></div></div>
                <div class="logo-uploader"><label class="logo-label" onclick="document.getElementById('evt-logo').click()"><i class="fas fa-image"></i> <span data-i18n="lbl_logo_add">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏™‡πà‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á</span></label><input type="file" id="evt-logo" accept="image/*" onchange="generateEvent()" style="display:none;"><span id="evt-logo-name" class="logo-name"></span></div>
                <div class="form-group"><label data-i18n="lbl_evt_title">‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô / ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</label><input type="text" id="evt-title" oninput="generateEvent()" placeholder="Meeting"></div>
                <div class="grid-2">
                    <div class="form-group"><label data-i18n="lbl_evt_start">‡πÄ‡∏£‡∏¥‡πà‡∏° (Start)</label><input type="datetime-local" id="evt-start" oninput="generateEvent()" style="width:100%;"></div>
                    <div class="form-group"><label data-i18n="lbl_evt_end">‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î (End)</label><input type="datetime-local" id="evt-end" oninput="generateEvent()" style="width:100%;"></div>
                </div>
                <div class="form-group"><label data-i18n="lbl_evt_loc">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label><input type="text" id="evt-loc" oninput="generateEvent()" placeholder="Meeting Room 1"></div>
                <div class="form-group"><label data-i18n="lbl_note">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î / ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (Description)</label><textarea id="evt-desc" oninput="generateEvent()" placeholder="Agenda details..."></textarea></div>
                <div class="action-footer"><div class="grid-2" style="margin-top: 0;"><button class="btn-action btn-outline" onclick="attemptCopy('event-qrcode')"><i class="fas fa-copy"></i> <span data-i18n="btn_copy">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏π‡∏õ</span></button><button class="btn-action" onclick="downloadImage('event-qrcode', 'Event')"><i class="fas fa-download"></i> <span data-i18n="btn_download">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</span></button></div></div>
            </div>
        </div>

        <div id="password" class="tool-panel">
            <div class="panel-header"><div><h2><i class="fas fa-key"></i> <span data-i18n="title_pass">Password Gen</span></h2><p class="tool-desc" data-i18n="desc_pass">‡∏™‡∏∏‡πà‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏™‡∏π‡∏á</p></div></div>
            <div class="card">
                <div class="pass-display" id="pass-result" onclick="copyPassText()" title="Click to Copy" style="cursor:pointer; transition:all 0.2s;">...</div>
                <div style="text-align:center; font-size:0.8rem; color:var(--text-sec); margin-top:-15px; margin-bottom:20px;">(‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å)</div>

                <div class="grid-2">
                    <div class="form-group">
                         <label data-i18n="lbl_pass_len">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß: <span id="len-val" style="color:var(--accent)">12</span></label>
                         <input type="range" id="pass-len" min="6" max="32" value="12" oninput="document.getElementById('len-val').innerText=this.value; generatePass();">
                    </div>
                    <div class="form-group">
                        <label class="checkbox-wrapper"><input type="checkbox" id="pass-upper" checked onchange="generatePass()"> A-Z (‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà)</label>
                        <label class="checkbox-wrapper"><input type="checkbox" id="pass-lower" checked onchange="generatePass()"> a-z (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡πá‡∏Å)</label>
                        <label class="checkbox-wrapper"><input type="checkbox" id="pass-num" checked onchange="generatePass()"> 0-9 (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç)</label>
                        <label class="checkbox-wrapper"><input type="checkbox" id="pass-sym" checked onchange="generatePass()"> @#$ (‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå)</label>
                        <label class="checkbox-wrapper" style="color:var(--text-sec); border-top:1px solid var(--border); padding-top:5px; margin-top:5px;"><input type="checkbox" id="pass-amb" onchange="generatePass()"> <span data-i18n="lbl_pass_amb">‡∏ï‡∏±‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏™‡∏±‡∏ö‡∏™‡∏ô (No Ambiguous)</span></label>
                    </div>
                </div>
                <button class="btn-action" onclick="generatePass()" style="margin-top:10px;"><i class="fas fa-sync-alt"></i> <span data-i18n="btn_regen">‡∏™‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà (Regenerate)</span></button>
                <div style="margin-top:20px; border-top:1px dashed var(--border); padding-top:20px;">
                    <h4 style="margin:0 0 10px 0; color:var(--text-sec); text-align:center;" data-i18n="lbl_pass_qr">QR ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠</h4>
                    <div class="preview-zone" id="dz-pass" style="min-height:180px;"><div id="pass-qrcode"></div></div>
                </div>
                <div class="action-footer"><div class="grid-2" style="margin-top: 0;"><button class="btn-action btn-outline" onclick="copyPassText()"><i class="fas fa-copy"></i> Copy Text</button><button class="btn-action" onclick="downloadImage('pass-qrcode', 'PasswordQR')"><i class="fas fa-download"></i> Save QR</button></div></div>
            </div>
        </div>

        <div id="barcode" class="tool-panel">
            <div class="panel-header"><div><h2><i class="fas fa-barcode"></i> <span data-i18n="title_bc">Barcode Maker</span></h2><p class="tool-desc" data-i18n="desc_bc">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ / ‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå</p></div></div>
            <div class="card">
                <div class="preview-zone" id="dz-barcode" style="min-height: 200px; display:flex; align-items:center; justify-content:center;">
                    <canvas id="barcode-canvas"></canvas>
                    <div id="barcode-error" style="color:var(--danger); display:none; font-weight:bold;"><i class="fas fa-exclamation-triangle"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (Invalid Data)</div>
                </div>
                
                <div class="form-group">
                    <label data-i18n="lbl_code">‡∏£‡∏´‡∏±‡∏™ / ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (Data)</label>
                    <input type="text" id="bc-text" oninput="debouncedBar()" placeholder="CNS-2026-01">
                </div>

                <div class="grid-2">
                    <div class="form-group">
                        <label data-i18n="lbl_format">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö (Format)</label>
                        <select id="bc-format" onchange="debouncedBar()">
                            <option value="CODE128">Code 128 (‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ)</option>
                            <option value="EAN13">EAN-13 (‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏õ‡∏•‡∏µ‡∏Å)</option>
                            <option value="UPC">UPC (12 ‡∏´‡∏•‡∏±‡∏Å)</option>
                            <option value="CODE39">Code 39 (‡∏≠‡∏∏‡∏ï‡∏™‡∏≤‡∏´‡∏Å‡∏£‡∏£‡∏°)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label data-i18n="lbl_show_text">‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</label>
                        <select id="bc-display" onchange="debouncedBar()">
                            <option value="true">‡πÅ‡∏™‡∏î‡∏á (Show)</option>
                            <option value="false">‡∏ã‡πà‡∏≠‡∏ô (Hide)</option>
                        </select>
                    </div>
                </div>

                <div class="grid-2">
                    <div class="form-group">
                        <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á (Height): <span id="val-bc-h" style="color:var(--accent)">100</span>px</label>
                        <input type="range" id="bc-height" min="10" max="150" value="100" oninput="document.getElementById('val-bc-h').innerText=this.value; debouncedBar();" style="width:100%;">
                    </div>
                    <div class="form-group">
                        <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤ (Width): <span id="val-bc-w" style="color:var(--accent)">2</span>px</label>
                        <input type="range" id="bc-width" min="1" max="4" value="2" oninput="document.getElementById('val-bc-w').innerText=this.value; debouncedBar();" style="width:100%;">
                    </div>
                </div>

                <div class="action-footer"><div class="grid-2" style="margin-top: 0;"><button class="btn-action btn-outline" onclick="attemptCopy('barcode-canvas')"><i class="fas fa-copy"></i> <span data-i18n="btn_copy">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏π‡∏õ</span></button><button class="btn-action" onclick="downloadImage('barcode-canvas', 'Barcode')"><i class="fas fa-download"></i> <span data-i18n="btn_download">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</span></button></div></div>
            </div>
        </div>

        <div id="wifi" class="tool-panel">
            <div class="panel-header"><div><h2><i class="fas fa-wifi"></i> <span data-i18n="title_wifi">WiFi QR</span></h2><p class="tool-desc" data-i18n="desc_wifi">QR ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ WiFi ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p></div></div>
            <div class="card">
                <div class="preview-zone" id="dz-wifi"><div id="wifi-qrcode"></div></div>
                <div class="logo-uploader"><label class="logo-label" onclick="document.getElementById('wifi-logo').click()"><i class="fas fa-image"></i> <span data-i18n="lbl_logo_add">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏™‡πà‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á</span></label><input type="file" id="wifi-logo" accept="image/*" onchange="generateWifi()" style="display:none;"><span id="wifi-logo-name" class="logo-name"></span></div>
                <div class="grid-2">
                    <div class="form-group"><label data-i18n="lbl_ssid">‡∏ä‡∏∑‡πà‡∏≠ WiFi (SSID)</label><input type="text" id="wifi-ssid" oninput="generateWifi()" placeholder="MyOffice_5G"></div>
                    <div class="form-group"><label data-i18n="lbl_security">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</label><select id="wifi-type" onchange="generateWifi()"><option value="WPA">WPA/WPA2 (‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô)</option><option value="SAE">WPA3 (‡πÉ‡∏´‡∏°‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</option><option value="WEP">WEP</option><option value="nopass">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (Open)</option></select></div>
                </div>
                <div class="form-group"><label data-i18n="lbl_pass">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label><input type="text" id="wifi-pass" oninput="generateWifi()" placeholder="Password"></div>
                <div class="form-group"><label class="checkbox-wrapper"><input type="checkbox" id="wifi-hidden" onchange="generateWifi()"> <span data-i18n="lbl_hidden">‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠ (Hidden SSID)</span></label></div>
                <div class="action-footer"><div class="grid-2" style="margin-top: 0;"><button class="btn-action btn-outline" onclick="attemptCopy('wifi-qrcode')"><i class="fas fa-copy"></i> <span data-i18n="btn_copy">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏π‡∏õ</span></button><button class="btn-action" onclick="downloadImage('wifi-qrcode', 'WiFi')"><i class="fas fa-download"></i> <span data-i18n="btn_download">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</span></button></div></div>
            </div>
        </div>

        <div id="bulk" class="tool-panel">
            <div class="panel-header">
                <div><h2><i class="fas fa-file-excel"></i> <span data-i18n="title_bulk">Bulk QR Generator</span></h2><p class="tool-desc" data-i18n="desc_bulk">‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏≤‡∏Å‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô Excel</p></div>
            </div>
            <div class="card">
                <div class="instruction-box" id="bulk-instructions">
                    <div class="instruction-title"><i class="fas fa-book"></i> <span data-i18n="lbl_instruction">‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Instructions)</span></div>
                    <ul class="step-list">
                        <li data-i18n="step_1">1. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ü‡∏•‡πå Excel (.xlsx) ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Column A</li>
                        <li data-i18n="step_2">2. ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ß‡πâ‡∏•‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</li>
                        <li data-i18n="step_3">3. ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î" ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡πÉ‡∏™‡πà‡πÑ‡∏ü‡∏•‡πå Excel ‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</li>
                    </ul>
                </div>

                <div class="upload-zone" id="drop-zone" onclick="document.getElementById('file-input').click()">
                    <input type="file" id="file-input" accept=".xlsx, .xls, .csv, .txt" style="display:none;" onchange="handleFileSelect(this.files[0])">
                    <i class="fas fa-cloud-upload-alt upload-icon"></i>
                    <div><div class="upload-text" data-i18n="lbl_drop">‡∏Ñ‡∏•‡∏¥‡∏Å ‡∏´‡∏£‡∏∑‡∏≠ ‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</div><div class="upload-sub" data-i18n="lbl_support">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Excel (.xlsx), CSV, ‡∏´‡∏£‡∏∑‡∏≠ Text File (.txt)</div></div>
                </div>

                <div id="settings-area" style="display:none;">
                    <button class="btn-outline" onclick="resetBulkUI()" style="margin-bottom: 20px; width: 100%; justify-content:center; border-style:dashed;">
                        <i class="fas fa-arrow-left"></i> <span data-i18n="btn_reupload">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà (Upload New File)</span>
                    </button>

                    <div class="grid-2">
                        <div class="form-group">
                            <label data-i18n="lbl_col">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Column)</label>
                            <select id="col-select" onchange="updatePreview()"><option value="0">Column A / Text Line</option></select>
                        </div>
                        <div class="form-group">
                            <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏ô‡∏ó‡∏≤‡∏ô (ECC Level)</label>
                            <select id="bulk-ecc">
                                <option value="L">L (7%)</option>
                                <option value="M" selected>M (15%)</option>
                                <option value="Q">Q (25%)</option>
                                <option value="H">H (30%)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà .xlsx)</label>
                        <input type="text" id="bulk-filename" placeholder="CNS_Result">
                    </div>

                    <div style="margin-top:15px; display:flex; gap:10px;">
                        <span class="privacy-badge" style="background:var(--drop-bg); color:var(--text-sec); border:1px solid var(--border); border-radius:4px; padding:5px 10px; font-size:0.8rem;"><i class="fas fa-file-alt"></i> <span id="file-name-display">filename.xlsx</span></span>
                        <span class="privacy-badge" style="background:var(--drop-bg); color:var(--text-sec); border:1px solid var(--border); border-radius:4px; padding:5px 10px; font-size:0.8rem;"><i class="fas fa-list-ol"></i> <span id="row-count-display">0 rows</span></span>
                    </div>

                    <h4 style="margin-top:20px; color:var(--text-main);" data-i18n="lbl_preview">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (5 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å)</h4>
                    <div class="preview-container" style="display:block;">
                        <table id="preview-table" class="bulk-table"><thead><tr><th>No.</th><th>Data</th><th>QR Preview</th></tr></thead><tbody></tbody></table>
                    </div>

                    <div class="progress-container" id="progress-container"><div class="progress-bar-bg"><div class="progress-bar-fill" id="progress-fill"></div></div><div class="progress-text" id="progress-text">Processing 0/0...</div></div>
                    <div class="action-footer"><button class="btn-action" id="btn-process" onclick="processAndDownload()"><i class="fas fa-cogs"></i> <span data-i18n="btn_process">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Excel</span></button></div>
                </div>
            </div>
        </div>

    </main>

    <div id="toast-container"></div>

    <script>
        const i18n = {
            th: {
                grp_gen: "Generators", grp_bulk: "Batch Processing",
                menu_pp: "QR ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô (PromptPay)", menu_qr: "QR Code", menu_vcard: "VCard (‡∏ô‡∏≤‡∏°‡∏ö‡∏±‡∏ï‡∏£)", menu_loc: "Location (‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà)", menu_event: "Event (‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢)", menu_pass: "Password (‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô)", menu_barcode: "Barcode Maker", menu_wifi: "WiFi QR", menu_bulk: "QR ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå (Bulk Excel)",
                title_pp: "PromptPay Generator", desc_pp: "‡∏™‡∏£‡πâ‡∏≤‡∏á QR ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡πÑ‡∏ó‡∏¢",
                title_qr: "QR Code Generator", desc_qr: "‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ",
                title_vcard: "VCard Generator", desc_vcard: "‡∏™‡∏£‡πâ‡∏≤‡∏á QR ‡∏ô‡∏≤‡∏°‡∏ö‡∏±‡∏ï‡∏£‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏• (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢)",
                title_loc: "Location Map QR", desc_loc: "‡∏™‡∏£‡πâ‡∏≤‡∏á QR ‡∏û‡∏¥‡∏Å‡∏±‡∏î Google Maps",
                title_event: "Event Calendar QR", desc_event: "‡∏™‡∏£‡πâ‡∏≤‡∏á QR ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏•‡∏á‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô",
                title_pass: "Password Generator", desc_pass: "‡∏™‡∏∏‡πà‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏™‡∏π‡∏á",
                title_bc: "Barcode Maker", desc_bc: "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ / ‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå",
                title_wifi: "WiFi QR Code", desc_wifi: "QR ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ WiFi",
                title_bulk: "Bulk QR Generator", desc_bulk: "‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏≤‡∏Å‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô Excel",
                lbl_logo_add: "+ ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏™‡πà‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á",
                lbl_pp_id: "‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ / ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£", lbl_pp_amount: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)", lbl_acc_type: "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏±‡∏ç‡∏ä‡∏µ",
                lbl_text: "‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° / URL", lbl_size: "‡∏Ç‡∏ô‡∏≤‡∏î (px)", lbl_color: "‡∏™‡∏µ", lbl_data_type: "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•",
                lbl_fname: "‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á", lbl_lname: "‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•", lbl_org: "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó / ‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£", lbl_title: "‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á",
                lbl_tel: "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠", lbl_email: "‡∏≠‡∏µ‡πÄ‡∏°‡∏•", lbl_website: "‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå", lbl_address: "‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà (Address)", lbl_note: "‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (Note)",
                lbl_evt_title: "‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô / ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°", lbl_evt_start: "‡πÄ‡∏£‡∏¥‡πà‡∏° (Start)", lbl_evt_end: "‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î (End)", lbl_evt_loc: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà",
                lbl_pass_len: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß:", lbl_pass_qr: "QR ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠", lbl_pass_amb: "‡∏ï‡∏±‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏™‡∏±‡∏ö‡∏™‡∏ô (No Ambiguous)",
                lbl_code: "‡∏£‡∏´‡∏±‡∏™ / ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç", lbl_format: "‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö", lbl_show_text: "‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç",
                lbl_ssid: "‡∏ä‡∏∑‡πà‡∏≠ WiFi (SSID)", lbl_security: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢", lbl_pass: "‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô",
                lbl_hidden: "‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠ (Hidden SSID)", hint_preview: "‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á QR Code ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà",
                opt_wpa: "WPA/WPA2 (‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô)", opt_wpa3: "WPA3 (‡πÉ‡∏´‡∏°‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)", opt_nopass: "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (Open)",
                btn_copy: "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏π‡∏õ", btn_download: "‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î", btn_reset: "‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤", btn_regen: "‡∏™‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà (Regenerate)", btn_get_loc: "‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (GPS)",
                msg_copy_ok: "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢", msg_copy_text_ok: "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß", msg_copy_fail: "Browser ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö (‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î)",
                msg_offline: "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î Libraries ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï",
                // Bulk Tool
                lbl_instruction: "‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Instructions)", step_1: "1. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ü‡∏•‡πå Excel (.xlsx) ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Column A", step_2: "2. ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ß‡πâ‡∏•‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á", step_3: "3. ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° '‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î' ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡πÉ‡∏™‡πà‡πÑ‡∏ü‡∏•‡πå Excel ‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ", 
                lbl_drop: "‡∏Ñ‡∏•‡∏¥‡∏Å ‡∏´‡∏£‡∏∑‡∏≠ ‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà", lbl_support: "‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Excel (.xlsx), CSV, ‡∏´‡∏£‡∏∑‡∏≠ Text File (.txt)", lbl_col: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ó‡∏≥ QR", lbl_preview: "‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (5 ‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å)", btn_process: "‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Excel", btn_reupload: "‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà (Upload New File)", msg_load_ok: "‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢", msg_process_start: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...", msg_complete: "‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î", msg_error: "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå", msg_no_data: "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå"
            },
            en: {
                grp_gen: "Generators", grp_bulk: "Batch Processing",
                menu_pp: "Thai PromptPay", menu_qr: "QR Code", menu_vcard: "VCard", menu_loc: "Location", menu_event: "Event", menu_pass: "Password", menu_barcode: "Barcode", menu_wifi: "WiFi QR", menu_bulk: "Bulk QR from File",
                title_pp: "PromptPay Generator", desc_pp: "Thai Standard Payment QR",
                title_qr: "QR Code Generator", desc_qr: "Generate QR from Text/URL",
                title_vcard: "VCard Generator", desc_vcard: "Digital Business Card QR (Thai Supported)",
                title_loc: "Location Map QR", desc_loc: "Google Maps Coordinate QR",
                title_event: "Event Calendar QR", desc_event: "Calendar Appointment QR",
                title_pass: "Password Generator", desc_pass: "Secure Random Password",
                title_bc: "Barcode Maker", desc_bc: "Create Product Barcodes",
                title_wifi: "WiFi QR Code", desc_wifi: "Instant WiFi Connect",
                title_bulk: "Bulk QR Generator", desc_bulk: "Convert codes/text from Excel/Text file to QR Codes instantly",
                lbl_logo_add: "+ Add Center Logo",
                lbl_pp_id: "ID / Mobile Number", lbl_pp_amount: "Amount (THB)", lbl_acc_type: "Account Type",
                lbl_text: "Text / URL", lbl_size: "Size (px)", lbl_color: "Color", lbl_data_type: "Data Type",
                lbl_fname: "First Name", lbl_lname: "Last Name", lbl_org: "Company", lbl_title: "Job Title",
                lbl_tel: "Mobile", lbl_email: "Email", lbl_website: "Website", lbl_address: "Address", lbl_note: "Note",
                lbl_evt_title: "Event Title", lbl_evt_start: "Start", lbl_evt_end: "End", lbl_evt_loc: "Location",
                lbl_pass_len: "Length:", lbl_pass_qr: "Scan to Mobile", lbl_pass_amb: "No Ambiguous Characters",
                lbl_code: "Code / Number", lbl_format: "Format", lbl_show_text: "Show Text",
                lbl_ssid: "WiFi Name (SSID)", lbl_security: "Security", lbl_pass: "Password",
                lbl_hidden: "Hidden Network (Hidden SSID)", hint_preview: "QR Preview will appear here",
                opt_wpa: "WPA/WPA2 (Standard)", opt_wpa3: "WPA3 (Latest)", opt_nopass: "No Password (Open)",
                btn_copy: "Copy Image", btn_download: "Download", btn_reset: "Reset", btn_regen: "Regenerate", btn_get_loc: "Get My Location",
                msg_copy_ok: "Copied successfully", msg_copy_text_ok: "Text copied", msg_copy_fail: "Copy not supported, please Download",
                msg_offline: "Cannot load libraries. Please check internet.",
                // Bulk Tool
                lbl_instruction: "Instructions", step_1: "1. Prepare Excel file with data in Column A", step_2: "2. Upload your file below", step_3: "3. Click 'Generate & Download' to get Excel with QR Codes",
                lbl_drop: "Click or Drop file here", lbl_support: "Supports Excel (.xlsx), CSV, or Text File (.txt)", lbl_col: "Select Data Column", lbl_preview: "Data Preview (First 5 rows)", btn_process: "Generate & Download Excel", btn_reupload: "Upload New File", msg_load_ok: "File loaded successfully", msg_process_start: "Processing... Please wait", msg_complete: "Done! Downloading...", msg_error: "Error reading file", msg_no_data: "No data found"
            }
        };

        let curLang = localStorage.getItem('cns_gen_lang') || 'th';
        let debounceTimer;

        // Bulk Globals
        let globalData = [];
        let excelHeader = [];
        let isExcel = false;

        // --- UI FUNCTIONS ---
        function applyLanguage(){
            document.getElementById('lang-label').innerText = curLang.toUpperCase();
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const k = el.getAttribute('data-i18n');
                if(i18n[curLang][k]) el.innerText = i18n[curLang][k];
            });
            updatePPPlaceholder();
            updateQRPlaceholder();
        }
        function toggleLanguage() { curLang = curLang === 'th' ? 'en' : 'th'; localStorage.setItem('cns_gen_lang', curLang); applyLanguage(); if(document.querySelector('.tool-panel.active').id==='barcode') generateBarcode(); }
        function toggleTheme() {
            const isDark = document.body.getAttribute('data-theme') === 'dark';
            const newTheme = isDark ? 'light' : 'dark';
            document.body.setAttribute('data-theme', newTheme);
            document.getElementById('theme-icon').className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            localStorage.setItem('cns_gen_theme', newTheme);
        }
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); document.querySelector('.menu-overlay').classList.toggle('active'); }
        function switchTab(id, btn) {
            document.querySelectorAll('.tool-panel').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');
            if(window.innerWidth <= 768) toggleSidebar();
        }
        function toast(m, type='success'){ const c=document.getElementById('toast-container'), e=document.createElement('div'); e.className=`toast ${type}`; e.innerHTML=`<i class="fas fa-${type==='success'?'check-circle':'exclamation-circle'}"></i><span>${m}</span>`; c.appendChild(e); setTimeout(()=>e.remove(),3000); }
        function resetTool(id) {
            if(id === 'bulk') {
                resetBulkUI();
                return;
            }
            document.querySelectorAll(`#${id} input:not([type=range])`).forEach(i => i.value = '');
            document.querySelectorAll(`#${id} textarea`).forEach(i => i.value = '');
            document.querySelectorAll(`#${id} input[type=checkbox]`).forEach(i => i.checked = true);
            if(id === 'qr') { document.getElementById('qr-size').value = 250; document.getElementById('qr-color').value = '#000000'; document.getElementById('qr-type').value = 'text'; updateQRPlaceholder(); generateQR(); }
            if(id === 'promptpay') { document.getElementById('pp-type').value = 'mobile'; updatePPPlaceholder(); generatePromptPay(); }
            if(id === 'vcard') generateVCard();
            if(id === 'location') generateLocation();
            if(id === 'event') generateEvent();
            if(id === 'password') { document.getElementById('pass-len').value=12; document.getElementById('len-val').innerText="12"; document.getElementById('pass-amb').checked=false; generatePass(); }
            if(id === 'barcode') { document.getElementById('bc-height').value = 100; document.getElementById('val-bc-h').innerText = "100"; document.getElementById('bc-width').value = 2; document.getElementById('val-bc-w').innerText = "2"; generateBarcode(); }
            if(id === 'wifi') { document.getElementById('wifi-type').value = 'WPA'; document.getElementById('wifi-hidden').checked = false; generateWifi(); }
            document.querySelectorAll(`#${id} span[id$="-logo-name"]`).forEach(s => s.innerText = "");
            toast(i18n[curLang].btn_reset);
        }

        // --- HELPER FOR UTF-8 ENCODING (FIX FOR THAI) ---
        function makeUtf8(str) {
            return unescape(encodeURIComponent(str));
        }

        // --- DEBOUNCE & LOGIC ---
        function debouncedPP() { clearTimeout(debounceTimer); debounceTimer = setTimeout(generatePromptPay, 300); }
        function debouncedQR() { clearTimeout(debounceTimer); debounceTimer = setTimeout(generateQR, 300); }
        function debouncedVCard() { clearTimeout(debounceTimer); debounceTimer = setTimeout(generateVCard, 300); }
        function debouncedBar() { clearTimeout(debounceTimer); debounceTimer = setTimeout(generateBarcode, 300); }
        function escapeWifi(str) { if (!str) return ""; return str.replace(/([\\;:,\"])/g, '\\$1'); }
        function formatDate(d) { return d ? d.replace(/[-:]/g, "") + "00" : ""; }

        function updatePPPlaceholder() {
            const type = document.getElementById("pp-type").value;
            const ph = { 'mobile': '08x-xxx-xxxx', 'id': '1-xxxx-xxxxx-xx-x', 'wallet': '14000-xxxx-xxxxx (15 Digits)' };
            document.getElementById("pp-id").placeholder = ph[type];
        }

        function updateQRPlaceholder() {
            const type = document.getElementById("qr-type").value;
            const ph = { 'text': '‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° / Text', 'url': 'www.example.com', 'tel': '08x-xxx-xxxx', 'sms': '08x-xxx-xxxx', 'email': 'name@example.com' };
            document.getElementById("qr-text").placeholder = ph[type] || '...';
        }

        function generatePromptPay() {
            if(typeof QRCode === 'undefined') return;
            const c = document.getElementById("pp-qrcode"); c.innerHTML = "";
            const type = document.getElementById("pp-type").value;
            let target = document.getElementById("pp-id").value.replace(/[^0-9]/g, '');
            let amount = document.getElementById("pp-amount").value;
            let ppPayload = "";
            
            if(!target) {
                ppPayload = "00020101021129370016A000000677010111011300668999999995802TH53037646304"; 
            } else {
                let targetTag = "";
                if (type === 'mobile') { if(target.startsWith('0')) target = target.substring(1); targetTag = "0016A00000067701011101130066" + target; } 
                else if (type === 'id') { targetTag = "0016A0000006770101110213" + target; } 
                else if (type === 'wallet') { targetTag = "0016A0000006770101110315" + target; }
                const data = ["000201", "0102" + (amount ? "12" : "11"), "29" + ("00" + targetTag.length).slice(-2) + targetTag, "5802TH", "5303764"];
                if(amount && !isNaN(parseFloat(amount))) { let amtStr = parseFloat(amount).toFixed(2); data.push("54" + ("00" + amtStr.length).slice(-2) + amtStr); }
                let rawData = data.join("") + "6304"; ppPayload = rawData + calcCRC16(rawData);
            }
            try { new QRCode(c, { text: ppPayload, width: 250, height: 250, correctLevel: QRCode.CorrectLevel.H }); handleLogo('pp', c); } catch(e) {}
        }

        function generateQR() {
            const c = document.getElementById("qrcode"); c.innerHTML = "";
            const type = document.getElementById("qr-type").value;
            let val = document.getElementById("qr-text").value;
            let txt = val || "CNS_TOOLS_PREVIEW";
            if (val) {
                if (type === 'url' && !val.startsWith('http')) txt = 'https://' + val;
                else if (type === 'tel') txt = 'tel:' + val;
                else if (type === 'sms') txt = 'smsto:' + val;
                else if (type === 'email') txt = 'mailto:' + val;
            }
            try { new QRCode(c, { text: makeUtf8(txt), width: parseInt(document.getElementById("qr-size").value)||250, height: parseInt(document.getElementById("qr-size").value)||250, colorDark: document.getElementById("qr-color").value, correctLevel: QRCode.CorrectLevel.H }); handleLogo('qr', c); } catch(e) {}
        }

        function generateVCard() {
            const c = document.getElementById("vcard-qrcode"); 
            if (!c) return;
            c.innerHTML = "";
            let fname = document.getElementById("vc-fname").value || "Name";
            let lname = document.getElementById("vc-lname").value || "Surname";
            let org = document.getElementById("vc-org").value;
            let title = document.getElementById("vc-title").value;
            let tel = document.getElementById("vc-tel").value;
            let email = document.getElementById("vc-email").value;
            let url = document.getElementById("vc-url").value;
            let adr = document.getElementById("vc-adr").value;
            let note = document.getElementById("vc-note").value;
            
            let vcard = `BEGIN:VCARD\nVERSION:3.0\nN;CHARSET=UTF-8:${lname};${fname};;;\nFN;CHARSET=UTF-8:${fname} ${lname}\nORG;CHARSET=UTF-8:${org}\nTITLE;CHARSET=UTF-8:${title}\nTEL;TYPE=CELL:${tel}\nEMAIL:${email}\nURL:${url}\nADR;TYPE=WORK;CHARSET=UTF-8:;;${adr.replace(/\n/g, ", ")};;;\nNOTE;CHARSET=UTF-8:${note}\nEND:VCARD`;
            
            try { 
                new QRCode(c, { 
                    text: makeUtf8(vcard), // Applied UTF-8 Fix
                    width: 250, 
                    height: 250, 
                    correctLevel: QRCode.CorrectLevel.L // Low for max data capacity
                }); 
                handleLogo('vcard', c); 
            } catch(e) { c.innerHTML = "<span style='color:red; font-size:0.8rem;'>Data overflow or Error</span>"; }
        }

        function generateLocation() {
            const c = document.getElementById("loc-qrcode"); c.innerHTML = "";
            let lat = document.getElementById("loc-lat").value || "13.7563";
            let long = document.getElementById("loc-long").value || "100.5018";
            let link = `https://www.google.com/maps?q=${lat},${long}`;
            try { new QRCode(c, { text: link, width: 250, height: 250, correctLevel: QRCode.CorrectLevel.H }); handleLogo('loc', c); } catch(e) {}
        }
        
        function getLocation() {
            if (navigator.geolocation) {
                const btn = document.querySelector("button[onclick='getLocation()'] span");
                const oldText = btn.innerText;
                btn.innerText = "Locating...";
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        document.getElementById("loc-lat").value = position.coords.latitude.toFixed(6);
                        document.getElementById("loc-long").value = position.coords.longitude.toFixed(6);
                        generateLocation();
                        btn.innerText = oldText;
                        toast(i18n[curLang].msg_copy_ok.replace('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', '‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢').replace('Copied successfully', 'Location Found'));
                    },
                    (error) => { alert("Error: " + error.message); btn.innerText = oldText; }, { enableHighAccuracy: true }
                );
            } else { alert("Geolocation not supported"); }
        }

        function generateEvent() {
            const c = document.getElementById("event-qrcode"); c.innerHTML = "";
            let title = document.getElementById("evt-title").value || "Meeting";
            let start = document.getElementById("evt-start").value;
            let end = document.getElementById("evt-end").value;
            let loc = document.getElementById("evt-loc").value || "";
            let desc = document.getElementById("evt-desc").value.replace(/\n/g, "\\n") || "";
            if(!start) { const now = new Date(); start = now.toISOString().slice(0,16); }
            if(!end) { const next = new Date(); next.setHours(next.getHours()+1); end = next.toISOString().slice(0,16); }

            let ical = `BEGIN:VCALENDAR\nVERSION:2.0\nBEGIN:VEVENT\nSUMMARY:${title}\nDTSTART:${formatDate(start)}\nDTEND:${formatDate(end)}\nLOCATION:${loc}\nDESCRIPTION:${desc}\nEND:VEVENT\nEND:VCALENDAR`;
            try { new QRCode(c, { text: makeUtf8(ical), width: 250, height: 250, correctLevel: QRCode.CorrectLevel.H }); handleLogo('evt', c); } catch(e) {}
        }

        function generatePass() {
            const len = parseInt(document.getElementById("pass-len").value);
            const useAmb = document.getElementById("pass-amb").checked;
            const raw = { upper: "ABCDEFGHIJKLMNOPQRSTUVWXYZ", lower: "abcdefghijklmnopqrstuvwxyz", num: "0123456789", sym: "!@#$%^&*()_+~`|}{[]:;?><,./-=" };
            const noAmb = { upper: "ABCDEFGHJKLMNPQRSTUVWXYZ", lower: "abcdefghijkmnopqrstuvwxyz", num: "23456789", sym: "!@#$%^&*()_+~`|}{[]:;?><,./-=" };
            const set = useAmb ? noAmb : raw;
            let pool = "";
            let guarantee = "";
            const pick = (str) => str.charAt(Math.floor(Math.random() * str.length));

            if(document.getElementById("pass-upper").checked) { pool += set.upper; guarantee += pick(set.upper); }
            if(document.getElementById("pass-lower").checked) { pool += set.lower; guarantee += pick(set.lower); }
            if(document.getElementById("pass-num").checked)   { pool += set.num;   guarantee += pick(set.num); }
            if(document.getElementById("pass-sym").checked)   { pool += set.sym;   guarantee += pick(set.sym); }
            
            if(pool === "") { document.getElementById("pass-result").innerText = "Select Options"; document.getElementById("pass-qrcode").innerHTML = ""; return; }
            
            let pass = guarantee;
            for(let i=guarantee.length; i<len; i++) pass += pick(pool);
            pass = pass.split('').sort(() => 0.5 - Math.random()).join('');
            
            const display = document.getElementById("pass-result");
            display.innerText = pass;
            display.style.transform = "scale(1.05)"; setTimeout(() => display.style.transform = "scale(1)", 100);
            
            const c = document.getElementById("pass-qrcode"); c.innerHTML = "";
            try { new QRCode(c, { text: pass, width: 160, height: 160, correctLevel: QRCode.CorrectLevel.L }); } catch(e) {}
        }
        function copyPassText() { 
            const txt = document.getElementById("pass-result").innerText;
            if(txt === "Select Options" || txt === "...") return;
            navigator.clipboard.writeText(txt).then(() => {
                toast(i18n[curLang].msg_copy_text_ok);
                const d = document.getElementById("pass-result"); d.style.backgroundColor = "rgba(16,185,129,0.2)"; setTimeout(() => d.style.backgroundColor = "", 200);
            }); 
        }

        function generateBarcode() {
            if(typeof JsBarcode === 'undefined') return;
            let txt = document.getElementById("bc-text").value;
            let format = document.getElementById("bc-format").value;
            let height = parseInt(document.getElementById("bc-height").value) || 100;
            let width = parseInt(document.getElementById("bc-width").value) || 2;
            let displayValue = document.getElementById("bc-display").value === "true";

            if(!txt) {
                if (format === "EAN13") txt = "1234567890128";
                else if (format === "UPC") txt = "123456789012";
                else if (format === "ITF14") txt = "12345678901231";
                else txt = "CNS-2026-PRO";
            }

            try {
                JsBarcode("#barcode-canvas", txt, { format: format, lineColor: "#000", width: width, height: height, displayValue: displayValue, font: "Sarabun", background: "#ffffff", margin: 15 });
                document.getElementById("barcode-error").style.display = "none"; document.getElementById("barcode-canvas").style.display = "block";
            } catch (e) { document.getElementById("barcode-canvas").style.display = "none"; document.getElementById("barcode-error").style.display = "block"; }
        }

        function generateWifi() {
            const c = document.getElementById("wifi-qrcode"); c.innerHTML = "";
            let ssid = document.getElementById("wifi-ssid").value || "MyWiFi";
            let pass = document.getElementById("wifi-pass").value;
            let type = document.getElementById("wifi-type").value;
            let hidden = document.getElementById("wifi-hidden").checked;
            const passInput = document.getElementById("wifi-pass");
            
            if(type === 'nopass') { passInput.disabled = true; passInput.style.backgroundColor = "var(--drop-bg)"; pass = ''; } 
            else { passInput.disabled = false; passInput.style.backgroundColor = "var(--input-bg)"; }

            let str = `WIFI:S:${escapeWifi(ssid)};T:${type};`;
            if(type !== 'nopass') str += `P:${escapeWifi(pass)};`;
            if(hidden) str += `H:true;`;
            str += `;`;
            
            try { new QRCode(c, { text: str, width: 250, height: 250, correctLevel: QRCode.CorrectLevel.H }); handleLogo('wifi', c); } catch(e) {}
        }

        function calcCRC16(str) {
            let crc = 0xFFFF;
            for (let i = 0; i < str.length; i++) {
                let x = ((crc >> 8) ^ str.charCodeAt(i)) & 0xFF;
                x ^= x >> 4;
                crc = ((crc << 8) ^ (x << 12) ^ (x << 5) ^ x) & 0xFFFF;
            }
            return ("0000" + crc.toString(16).toUpperCase()).slice(-4);
        }

        function handleLogo(prefix, container) {
            const fileInput = document.getElementById(prefix + '-logo');
            setTimeout(() => {
                const imgQR = container.querySelector("img"); if(!imgQR) return;
                imgQR.style.maxWidth = "100%"; imgQR.style.height = "auto";
                if (fileInput.files && fileInput.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const logoImg = new Image();
                        logoImg.onload = function() { if(container.innerHTML !== "") addLogoToQR(container, logoImg); };
                        logoImg.src = e.target.result;
                    }; reader.readAsDataURL(fileInput.files[0]);
                }
            }, 50); 
        }

        function addLogoToQR(container, logoImg) {
            const qrImg = container.querySelector("img"); if(!qrImg) return;
            const canvas = document.createElement("canvas"); const ctx = canvas.getContext("2d");
            const size = qrImg.naturalWidth || qrImg.width || 250; 
            canvas.width = size; canvas.height = size;
            ctx.drawImage(qrImg, 0, 0, size, size);
            const logoSize = size * 0.22; const logoPos = (size - logoSize) / 2;
            ctx.fillStyle = "#ffffff"; ctx.beginPath(); ctx.rect(logoPos - 2, logoPos - 2, logoSize + 4, logoSize + 4); ctx.fill();
            ctx.drawImage(logoImg, logoPos, logoPos, logoSize, logoSize);
            container.innerHTML = ""; container.appendChild(canvas);
            canvas.style.maxWidth = "100%"; canvas.style.height = "auto";
        }

        function getElementToExport(id) {
            const el = document.getElementById(id); if (!el) return null;
            if (el.tagName === 'CANVAS' || el.tagName === 'IMG') return el; 
            return el.querySelector('canvas') || el.querySelector('img');
        }

        async function attemptCopy(id) {
            try {
                const targetEl = getElementToExport(id);
                if (targetEl) { 
                    let canvas;
                    if (targetEl.tagName === 'CANVAS') canvas = targetEl;
                    else { canvas = document.createElement('canvas'); canvas.width = targetEl.naturalWidth; canvas.height = targetEl.naturalHeight; canvas.getContext('2d').drawImage(targetEl, 0, 0); }
                    canvas.toBlob(async (blob) => { try { await navigator.clipboard.write([new ClipboardItem({'image/png': blob})]); toast(i18n[curLang].msg_copy_ok); } catch (err) { toast(i18n[curLang].msg_copy_fail, 'error'); } });
                } else toast(i18n[curLang].msg_copy_fail, 'error');
            } catch (e) { toast(i18n[curLang].msg_copy_fail, 'error'); }
        }

        function downloadImage(id, name) {
            const targetEl = getElementToExport(id);
            let url = "";
            if (targetEl) url = (targetEl.tagName === 'CANVAS') ? targetEl.toDataURL("image/png") : targetEl.src;
            if (url) { const a = document.createElement("a"); a.href = url; a.download = `${name}_${Date.now()}.png`; document.body.appendChild(a); a.click(); document.body.removeChild(a); }
        }

        // --- BULK FUNCTIONS ---
        // 1. Reset Bulk UI Function
        function resetBulkUI() {
            document.getElementById('settings-area').style.display = 'none';
            document.getElementById('drop-zone').style.display = 'flex';
            document.getElementById('bulk-instructions').style.display = 'block'; // Show instructions again
            document.getElementById('file-input').value = ''; // Clear input
            document.getElementById('progress-container').style.display = 'none';
            document.getElementById('btn-process').disabled = false;
            globalData = [];
            excelHeader = [];
            document.querySelector('#preview-table tbody').innerHTML = ''; // Clear preview
            document.getElementById('row-count-display').innerText = '0 rows';
            document.getElementById('file-name-display').innerText = 'filename.xlsx';
        }

        const dropZone = document.getElementById('drop-zone');
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('dragover'); });
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault(); dropZone.classList.remove('dragover');
            if (e.dataTransfer.files.length) handleFileSelect(e.dataTransfer.files[0]);
        });

        function handleFileSelect(file) {
            if (!file) return;
            const reader = new FileReader();
            const fileName = file.name;
            const ext = fileName.split('.').pop().toLowerCase();
            document.getElementById('file-name-display').innerText = fileName;
            
            reader.onload = function(e) {
                const data = e.target.result;
                globalData = []; excelHeader = [];

                if (ext === 'txt') {
                    isExcel = false;
                    const lines = data.split(/\r\n|\n/).filter(line => line.trim() !== '');
                    globalData = lines.map(l => [l.trim()]);
                    setupColumns(['Text Data']);
                } else if (['xlsx', 'xls', 'csv'].includes(ext)) {
                    isExcel = true;
                    try {
                        const workbook = XLSX.read(data, { type: 'binary' });
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];
                        const json = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: "" });
                        if (json.length > 0) {
                            excelHeader = json[0];
                            globalData = json.slice(1);
                            setupColumns(excelHeader.map((h, i) => h || `Col ${i+1}`));
                        } else { toast(i18n[curLang].msg_no_data, 'error'); return; }
                    } catch (err) { toast(i18n[curLang].msg_error, 'error'); return; }
                } else { toast("Unsupported file type", 'error'); return; }

                if (globalData.length > 0) {
                    document.getElementById('row-count-display').innerText = `${globalData.length} rows`;
                    document.getElementById('drop-zone').style.display = 'none';
                    document.getElementById('bulk-instructions').style.display = 'none'; // Hide instructions
                    document.getElementById('settings-area').style.display = 'block';
                    updatePreview();
                    toast(i18n[curLang].msg_load_ok);
                }
            };
            if (ext === 'txt') reader.readAsText(file); else reader.readAsBinaryString(file);
        }

        function setupColumns(headers) {
            const select = document.getElementById('col-select'); select.innerHTML = '';
            headers.forEach((h, index) => { const opt = document.createElement('option'); opt.value = index; opt.innerText = h; select.appendChild(opt); });
        }

        async function updatePreview() {
            const colIndex = parseInt(document.getElementById('col-select').value);
            const tbody = document.querySelector('#preview-table tbody'); tbody.innerHTML = '';
            const previewCount = Math.min(globalData.length, 5);
            for (let i = 0; i < previewCount; i++) {
                const row = globalData[i];
                const textVal = row[colIndex] || "";
                const tr = document.createElement('tr');
                let qrImgHtml = '<span style="color:#ccc;">...</span>';
                if(textVal) {
                    try {
                        const url = await HeadlessQRCode.toDataURL(String(textVal), { width: 50, margin: 1 });
                        qrImgHtml = `<img src="${url}" style="width:50px; border-radius:4px;">`;
                    } catch(e) {}
                }
                tr.innerHTML = `<td>${i + 1}</td><td style="max-width:200px; overflow:hidden; text-overflow:ellipsis;">${textVal}</td><td>${qrImgHtml}</td>`;
                tbody.appendChild(tr);
            }
        }

        async function processAndDownload() {
            const btn = document.getElementById('btn-process');
            const progressContainer = document.getElementById('progress-container');
            const fill = document.getElementById('progress-fill');
            const txt = document.getElementById('progress-text');
            const colIndex = parseInt(document.getElementById('col-select').value);
            
            // --- FIX SETTINGS AS REQUESTED ---
            const qrSize = 150; 
            const rowHeightPx = 230;
            const colWidthPx = 210; 

            const ecc = document.getElementById('bulk-ecc').value;
            let filename = document.getElementById('bulk-filename').value || "CNS_QR_Result";
            filename = filename.replace(/[^a-z0-9_.-]/gi, '_'); 

            // Calculate fractional offset for centering
            const rowOffset = 40 / 230; 
            const colOffset = 30 / 210;

            btn.disabled = true; progressContainer.style.display = 'block'; fill.style.width = '0%';

            setTimeout(async () => {
                try {
                    const workbook = new ExcelJS.Workbook();
                    const sheet = workbook.addWorksheet('QR Codes');
                    let headers = isExcel ? [...excelHeader] : ['Data'];
                    headers.push('QR Code Image');
                    sheet.addRow(headers);
                    sheet.getRow(1).font = { bold: true, size: 12 };
                    sheet.getRow(1).alignment = { vertical: 'middle', horizontal: 'center' };

                    const total = globalData.length;
                    
                    const rowHeightPt = rowHeightPx * 0.75; 
                    const colWidthChars = colWidthPx / 7;

                    for (let i = 0; i < total; i++) {
                        const originalRow = globalData[i];
                        const textData = String(originalRow[colIndex] || "");
                        const newRow = sheet.addRow([...originalRow]); 
                        const rowNum = i + 2;
                        
                        sheet.getRow(rowNum).height = rowHeightPt;

                        if (textData) {
                            try {
                                const qrDataUrl = await HeadlessQRCode.toDataURL(textData, { width: qrSize, margin: 1, errorCorrectionLevel: ecc });
                                const imageId = workbook.addImage({ base64: qrDataUrl, extension: 'png' });
                                const colCount = headers.length; 
                                
                                // Insert Image with Offset for Centering
                                sheet.addImage(imageId, { 
                                    tl: { col: colCount - 1 + colOffset, row: rowNum - 1 + rowOffset }, 
                                    ext: { width: qrSize, height: qrSize },
                                    editAs: 'oneCell' 
                                });
                                
                                // Also ensure cell content alignment
                                sheet.getCell(rowNum, colCount).alignment = { vertical: 'middle', horizontal: 'center' };
                            } catch (e) { console.error("QR Gen Error", e); }
                        }

                        if (i % 10 === 0 || i === total - 1) {
                            const percent = Math.round(((i + 1) / total) * 100);
                            fill.style.width = `${percent}%`;
                            txt.innerText = `Processing ${i + 1}/${total}...`;
                            await new Promise(r => setTimeout(r, 0));
                        }
                    }
                    sheet.columns.forEach((column, index) => { 
                        if(index < headers.length - 1) column.width = 25; 
                    });
                    
                    sheet.getColumn(headers.length).width = colWidthChars;

                    txt.innerText = "Finalizing Excel file...";
                    const buffer = await workbook.xlsx.writeBuffer();
                    const blob = new Blob([buffer], { type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" });
                    
                    saveAs(blob, `${filename}.xlsx`);
                    
                    toast(i18n[curLang].msg_complete);
                    btn.disabled = false;
                } catch (err) { toast("Error: " + err.message, "error"); btn.disabled = false; }
            }, 100);
        }

        window.onload = function() {
            if(typeof QRCode === 'undefined' || typeof JsBarcode === 'undefined') alert(i18n['th'].msg_offline);
            if(localStorage.getItem('cns_gen_theme') === 'dark') { document.body.setAttribute('data-theme', 'dark'); document.getElementById('theme-icon').className = 'fas fa-sun'; }
            if(localStorage.getItem('cns_gen_lang')) curLang = localStorage.getItem('cns_gen_lang');
            applyLanguage();
            generatePromptPay(); generateQR(); generateVCard(); generateLocation(); generateEvent(); generatePass(); generateBarcode(); generateWifi();
        }
    </script>
</body>
</html>